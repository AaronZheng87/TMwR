<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 A tidyverse primer | Tidy Modeling with R</title>
  <meta name="description" content="Modeling of data is integral to science, business, politics, and many other aspects of our lives. The goals of this book are to: introduce neophytes to models and the tidyverse, demonstrate the tidymodels packages, and to outline good practices for the phases of the modeling process." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="2 A tidyverse primer | Tidy Modeling with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Modeling of data is integral to science, business, politics, and many other aspects of our lives. The goals of this book are to: introduce neophytes to models and the tidyverse, demonstrate the tidymodels packages, and to outline good practices for the phases of the modeling process." />
  <meta name="github-repo" content="topepo/TMwR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 A tidyverse primer | Tidy Modeling with R" />
  <meta name="twitter:site" content="@topepos" />
  <meta name="twitter:description" content="Modeling of data is integral to science, business, politics, and many other aspects of our lives. The goals of this book are to: introduce neophytes to models and the tidyverse, demonstrate the tidymodels packages, and to outline good practices for the phases of the modeling process." />
  

<meta name="author" content="Max Kuhn and Davis Vaughan" />


<meta name="date" content="2020-01-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="two-models.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<script src="libs/elevate-section-attrs-2.0/elevate-section-attrs.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Tidy Modeling with R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Hello World</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#types-of-models"><i class="fa fa-check"></i><b>1.1</b> Types of models</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#some-terminology"><i class="fa fa-check"></i><b>1.2</b> Some terminology</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#model-phases"><i class="fa fa-check"></i><b>1.3</b> How does modeling fit into the data analysis/scientific process?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#begin-model-end"><i class="fa fa-check"></i><b>1.4</b> Where does the model begin and end?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#outline-of-future-chapters"><i class="fa fa-check"></i><b>1.5</b> Outline of future chapters</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tidyverse-primer.html"><a href="tidyverse-primer.html"><i class="fa fa-check"></i><b>2</b> A tidyverse primer</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tidyverse-primer.html"><a href="tidyverse-primer.html#principles"><i class="fa fa-check"></i><b>2.1</b> Principles</a></li>
<li class="chapter" data-level="2.2" data-path="tidyverse-primer.html"><a href="tidyverse-primer.html#code"><i class="fa fa-check"></i><b>2.2</b> Code</a></li>
<li class="chapter" data-level="2.3" data-path="tidyverse-primer.html"><a href="tidyverse-primer.html#r-review"><i class="fa fa-check"></i><b>2.3</b> A review of base R modeling syntax</a></li>
<li class="chapter" data-level="2.4" data-path="tidyverse-primer.html"><a href="tidyverse-primer.html#why-tidiness-is-important-for-modeling"><i class="fa fa-check"></i><b>2.4</b> Why tidiness is important for modeling</a></li>
<li class="chapter" data-level="2.5" data-path="tidyverse-primer.html"><a href="tidyverse-primer.html#some-additional-tidy-principals-for-modeling."><i class="fa fa-check"></i><b>2.5</b> Some additional tidy principals for modeling.</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="two-models.html"><a href="two-models.html"><i class="fa fa-check"></i><b>3</b> A tale of two models</a></li>
<li class="chapter" data-level="4" data-path="data-spending.html"><a href="data-spending.html"><i class="fa fa-check"></i><b>4</b> Spending our data</a></li>
<li class="chapter" data-level="5" data-path="model-metrics.html"><a href="model-metrics.html"><i class="fa fa-check"></i><b>5</b> How good is our model?</a></li>
<li class="chapter" data-level="6" data-path="feature-engineering.html"><a href="feature-engineering.html"><i class="fa fa-check"></i><b>6</b> Feature engineering</a></li>
<li class="chapter" data-level="7" data-path="workflows.html"><a href="workflows.html"><i class="fa fa-check"></i><b>7</b> A model workflow</a></li>
<li class="chapter" data-level="8" data-path="resampling.html"><a href="resampling.html"><i class="fa fa-check"></i><b>8</b> Resampling for evaluating performance</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tidy Modeling with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidyverse-primer" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> A tidyverse primer</h1>
<div id="principles" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Principles</h2>
<p>What does it mean to be “tidy” (distinguish tidy data vs tidy interfaces etc. )</p>
</div>
<div id="code" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Code</h2>
<p>Things that I think that we’ll need summaries of:</p>
<ul>
<li><p>strategies: variable specification, pipes (with data or other first arguments), conflicts and using namespaces, splicing, non-standard evaluation,</p></li>
<li><p>tactics: <code>select</code>, <code>bind_cols</code>, <code>tidyselect</code>, <code>slice</code>, <code>!!</code> and <code>!!!</code>, <code>...</code> for passing arguments, tibbles, joins, <code>nest</code>/<code>unnest</code>, <code>group_by</code></p></li>
</ul>
</div>
<div id="r-review" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> A review of base R modeling syntax</h2>
<p>This book is about software, specifically R syntax for creating models. Before descrbing how tidy principles can be used in data analysis, it makes sense to show how models are created and utilized using traditional base R code. This section is a brief illustration of the those conventions. It is not exhaustive but provides readers uninitiated to R ideas about the basic motifs that are commonly used.</p>
<p>The S language, on which R is based, has had a rich data analysis environment since the publication of <span class="citation">Chambers and Hastie (<a href="resampling.html#ref-WhiteBook" role="doc-biblioref">1992</a>)</span> (commonly known as The White Book). This version of S introduced standard infrastructure components, such as symbolic model formulae, model matrices, data frames, as well as the standard object-oriented programming methods for data analysis. Much of these implementations have not substantively changes since then.</p>
<p>To demonstrate the fundamentals, experimental data from <span class="citation">McDonald (<a href="resampling.html#ref-mcdonald2009" role="doc-biblioref">2009</a>)</span> (by way of <span class="citation">Mangiafico (<a href="resampling.html#ref-mangiafico2015" role="doc-biblioref">2015</a>)</span>) are used. These data relate how the ambient temperature related to the rate of cricket chirps per minute. Data were collected for two species: <em>O. exclamationis</em> and <em>O. niveus</em>. The data are contained in a data frame called <code>crickets</code> that contains a total of 31 data points. These data are shown via a <code>ggplot</code> graph.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="tidyverse-primer.html#cb2-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="tidyverse-primer.html#cb2-2"></a></span>
<span id="cb2-3"><a href="tidyverse-primer.html#cb2-3"></a><span class="kw">names</span>(crickets)</span>
<span id="cb2-4"><a href="tidyverse-primer.html#cb2-4"></a><span class="co">#&gt; [1] &quot;species&quot; &quot;temp&quot;    &quot;rate&quot;</span></span>
<span id="cb2-5"><a href="tidyverse-primer.html#cb2-5"></a></span>
<span id="cb2-6"><a href="tidyverse-primer.html#cb2-6"></a><span class="co"># Plot the temperature on the x-axis, the chirp rate on the y-axis. The plot</span></span>
<span id="cb2-7"><a href="tidyverse-primer.html#cb2-7"></a><span class="co"># elements will be colored differently for each species:</span></span>
<span id="cb2-8"><a href="tidyverse-primer.html#cb2-8"></a><span class="kw">ggplot</span>(crickets, <span class="kw">aes</span>(<span class="dt">x =</span> temp, <span class="dt">y =</span> rate, <span class="dt">col =</span> species)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-9"><a href="tidyverse-primer.html#cb2-9"></a><span class="st">  </span><span class="co"># Plot points for each data point and color by species</span></span>
<span id="cb2-10"><a href="tidyverse-primer.html#cb2-10"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-11"><a href="tidyverse-primer.html#cb2-11"></a><span class="st">  </span><span class="co"># Show a simple linear model fit created separately for each species:</span></span>
<span id="cb2-12"><a href="tidyverse-primer.html#cb2-12"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> lm, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2-13"><a href="tidyverse-primer.html#cb2-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Temperature (C)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Chirp Rate (per minute)&quot;</span>)</span></code></pre></div>
<p><img src="figures/tidyverse-cricket-plot-1.svg" width="100%" style="display: block; margin: auto;" /></p>
<p>The data show fairly linear trends for each species. For a given temperature, <em>O. exclamationis</em> appears to have more chirps than the other species. For an inferential model, the researchers might have specified the following null hypotheses prior to seeing the data:</p>
<ul>
<li><p>Temperature has no affect on the chirp rate (denoted as hypothesis #1)</p></li>
<li><p>There are no differences between the species in terms of chirp rate.</p></li>
</ul>
<p>There may be some scientific rationale for being able to predict the chirp rate but the focus here will be on inference.</p>
<p>To fit an ordinary linear model, the <code>lm()</code> function is commonly used. The important arguments to this function are a model formula and a data frame that contains the data The formula is <em>symbolic</em>. For example, the simple formula:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="tidyverse-primer.html#cb3-1"></a>rate <span class="op">~</span><span class="st"> </span>temp</span></code></pre></div>
<p>states that the chirp rate is the outcome (since it is on the left-hand side of the tidle <code>~</code>) and that the temperature values are the predictor<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. Suppose the data contained the time of day in which the measurements were obtained in a column called <code>time</code>. The formula</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="tidyverse-primer.html#cb4-1"></a>rate <span class="op">~</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>time</span></code></pre></div>
<p>would not add the time and temperature values together. This formula would symbolically represent that temperature and time should be added as a separate <em>main effects</em> to the model. Main effects are model terms that contain a single predictor variable.</p>
<p>There are no time measurements in these data but the species can be added to the model in the same way:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="tidyverse-primer.html#cb5-1"></a>rate <span class="op">~</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>species</span></code></pre></div>
<p>Species is not a quantitative variable; in the data frame, it is represented as a factor column with levels <code>"O. exclamationis"</code> and <code>"O. niveus"</code>. The vast majority of model functions cannot operate on non-numeric data. For species, the model needs to <em>encode</em> the species data into a numeric format. The most common approach is to use indicator variables (also known as “dummy variables”) in place of the original qualitative values. In this instance, since species has two possible values, the model formula will automatically encode this column as numeric by adding a new column that has a value of zero when the species is <code>"O. exclamationis"</code> and a value of one when the data correspond to <code>"O. niveus"</code>. The underlying formula machinery will automatically convert these data for the data used to create the model as well as for any new data points (for example, when the model is used for prediction).</p>
<p>Suppose there were five species. The model formula would automatically add <em>four</em> additional binary columns that are binary indicators for four of the species. The <em>reference level</em> of the factor (i.e., the first level) is always left out of the predictor set. The idea is that, if you know the values of the four indicator variables, the value of the species can be determined.</p>
<p>The model formula shown above creates a model where there are different y-intercepts for each species. It is a reasonable supposition that the slopes of the regression lines could be different for each species. To accommodate this structure, an <em>interaction</em> term can be added to the model. This can be specified in a few different ways, the most basic uses the colon:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="tidyverse-primer.html#cb6-1"></a>rate <span class="op">~</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>species <span class="op">+</span><span class="st"> </span>temp<span class="op">:</span>species</span>
<span id="cb6-2"><a href="tidyverse-primer.html#cb6-2"></a></span>
<span id="cb6-3"><a href="tidyverse-primer.html#cb6-3"></a><span class="co"># A shortcut can be used to expand all interactions containing</span></span>
<span id="cb6-4"><a href="tidyverse-primer.html#cb6-4"></a><span class="co"># interactions with two variables:</span></span>
<span id="cb6-5"><a href="tidyverse-primer.html#cb6-5"></a>rate <span class="op">~</span><span class="st"> </span>(temp <span class="op">+</span><span class="st"> </span>species)<span class="op">^</span><span class="dv">2</span></span></code></pre></div>
<p>In addition to the convenience of automatically creating indicator variables, the formula offers a few other niceties:</p>
<ul>
<li><p><em>In-line</em> functions can be used in the formula. For example, if the natural log of the temperate were used, the formula <code>rate ~ log(temp)</code> could be used. Since the formula is symbolic by default, literal math can be done to the predictors using the identity function <code>I()</code>. For example, to use Fahrenheit units, the formula could be <code>rate ~ I( (temp * 9/5) + 32 )</code> to make the conversion.</p></li>
<li><p>R has many functions that are useful inside of formulas. For example, <code>poly(x, 3)</code> would create linear, quadratic, and cubic terms for <code>x</code> to the model as main effects. Also, the <code>splines</code> package has several functions to create nonlinear spline terms in the formula.</p></li>
<li><p>For data sets where there are many predictors, the period shortcut is available. The period represents main effects for all of the columns that are not on the left-hand side of the tilde. For example, using <code>~ (.)^3</code> would create main effects as well as all two- and three-variable interactions to the model.</p></li>
</ul>
<p>For the initial data analysis, the two-factor interaction model is used. In this book, the suffix <code>_fit</code> is used for R objects for fitted models.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="tidyverse-primer.html#cb7-1"></a>interaction_fit &lt;-<span class="st">  </span><span class="kw">lm</span>(rate <span class="op">~</span><span class="st"> </span>(temp <span class="op">+</span><span class="st"> </span>species)<span class="op">^</span><span class="dv">2</span>, <span class="dt">data =</span> crickets) </span>
<span id="cb7-2"><a href="tidyverse-primer.html#cb7-2"></a></span>
<span id="cb7-3"><a href="tidyverse-primer.html#cb7-3"></a><span class="co"># To print a short summary of the model:</span></span>
<span id="cb7-4"><a href="tidyverse-primer.html#cb7-4"></a>interaction_fit</span>
<span id="cb7-5"><a href="tidyverse-primer.html#cb7-5"></a><span class="co">#&gt; </span></span>
<span id="cb7-6"><a href="tidyverse-primer.html#cb7-6"></a><span class="co">#&gt; Call:</span></span>
<span id="cb7-7"><a href="tidyverse-primer.html#cb7-7"></a><span class="co">#&gt; lm(formula = rate ~ (temp + species)^2, data = crickets)</span></span>
<span id="cb7-8"><a href="tidyverse-primer.html#cb7-8"></a><span class="co">#&gt; </span></span>
<span id="cb7-9"><a href="tidyverse-primer.html#cb7-9"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb7-10"><a href="tidyverse-primer.html#cb7-10"></a><span class="co">#&gt;           (Intercept)                   temp  </span></span>
<span id="cb7-11"><a href="tidyverse-primer.html#cb7-11"></a><span class="co">#&gt;               -11.041                  3.751  </span></span>
<span id="cb7-12"><a href="tidyverse-primer.html#cb7-12"></a><span class="co">#&gt;      speciesO. niveus  temp:speciesO. niveus  </span></span>
<span id="cb7-13"><a href="tidyverse-primer.html#cb7-13"></a><span class="co">#&gt;                -4.348                 -0.234</span></span></code></pre></div>
<p>This output is a little hard to read. For the species indicator variables, R mashes the variable name (<code>species</code>) together with the factor level (<code>O. niveus</code>) with no delimiter.</p>
<p>Before going into any results for this model, the fit should be assessed using diagnostic plots. The <code>plot()</code> method for <code>lm</code> objects can be used. It produces a set of four plots for the object, each showing different aspects of the fit. Two plots are shown here:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="tidyverse-primer.html#cb8-1"></a><span class="co"># Place two plots next to one another:</span></span>
<span id="cb8-2"><a href="tidyverse-primer.html#cb8-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb8-3"><a href="tidyverse-primer.html#cb8-3"></a></span>
<span id="cb8-4"><a href="tidyverse-primer.html#cb8-4"></a><span class="co"># Show residuals vs predicted values:</span></span>
<span id="cb8-5"><a href="tidyverse-primer.html#cb8-5"></a><span class="kw">plot</span>(interaction_fit, <span class="dt">which =</span> <span class="dv">1</span>)</span>
<span id="cb8-6"><a href="tidyverse-primer.html#cb8-6"></a></span>
<span id="cb8-7"><a href="tidyverse-primer.html#cb8-7"></a><span class="co"># A normal quantile plot on the residuals:</span></span>
<span id="cb8-8"><a href="tidyverse-primer.html#cb8-8"></a><span class="kw">plot</span>(interaction_fit, <span class="dt">which =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="figures/tidyverse-interaction-plots-1.svg" width="100%" style="display: block; margin: auto;" /></p>
<p>These appear reasonable enough to conduct inferential analysis.</p>
<p>From a technical standpoint, R is <em>lazy</em>. Model fitting functions typically compute the minimum possible quantities. For example, there may be interest in the coefficient table for each model term. This is not automatically computed but is instead computed via the <code>summary()</code> method.</p>
<p>Our second order of business is to assess if the inclusion of the interaction term is necessary. The most appropriate approach for this model is to re-compute the model without the interaction term and use the <code>anova()</code> method.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="tidyverse-primer.html#cb9-1"></a><span class="co"># Fit a reduced model:</span></span>
<span id="cb9-2"><a href="tidyverse-primer.html#cb9-2"></a>main_effect_fit &lt;-<span class="st">  </span><span class="kw">lm</span>(rate <span class="op">~</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>species, <span class="dt">data =</span> crickets) </span>
<span id="cb9-3"><a href="tidyverse-primer.html#cb9-3"></a></span>
<span id="cb9-4"><a href="tidyverse-primer.html#cb9-4"></a><span class="co"># Compare the two:</span></span>
<span id="cb9-5"><a href="tidyverse-primer.html#cb9-5"></a><span class="kw">anova</span>(main_effect_fit, interaction_fit)</span>
<span id="cb9-6"><a href="tidyverse-primer.html#cb9-6"></a><span class="co">#&gt; Analysis of Variance Table</span></span>
<span id="cb9-7"><a href="tidyverse-primer.html#cb9-7"></a><span class="co">#&gt; </span></span>
<span id="cb9-8"><a href="tidyverse-primer.html#cb9-8"></a><span class="co">#&gt; Model 1: rate ~ temp + species</span></span>
<span id="cb9-9"><a href="tidyverse-primer.html#cb9-9"></a><span class="co">#&gt; Model 2: rate ~ (temp + species)^2</span></span>
<span id="cb9-10"><a href="tidyverse-primer.html#cb9-10"></a><span class="co">#&gt;   Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)</span></span>
<span id="cb9-11"><a href="tidyverse-primer.html#cb9-11"></a><span class="co">#&gt; 1     28 89.3                         </span></span>
<span id="cb9-12"><a href="tidyverse-primer.html#cb9-12"></a><span class="co">#&gt; 2     27 85.1  1      4.28 1.36   0.25</span></span></code></pre></div>
<p>The results of the statistical test generates a p-value of 0.3. This value implies that there is a lack of evidence for the alternative hypothesis that the the interaction term is needed by the model. For this reason, further analysis will be conducted on the model without the interaction.</p>
<p>Residual plots should be re-assessed to make sure that our theoretical assumptions are valid enough to trust the p-values produced by the model (not shown but spoiler alert: they are).</p>
<p>The <code>summary()</code> method is used to inspect the coefficients, standard errors, and p-values of each model term:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="tidyverse-primer.html#cb10-1"></a><span class="kw">summary</span>(main_effect_fit)</span>
<span id="cb10-2"><a href="tidyverse-primer.html#cb10-2"></a><span class="co">#&gt; </span></span>
<span id="cb10-3"><a href="tidyverse-primer.html#cb10-3"></a><span class="co">#&gt; Call:</span></span>
<span id="cb10-4"><a href="tidyverse-primer.html#cb10-4"></a><span class="co">#&gt; lm(formula = rate ~ temp + species, data = crickets)</span></span>
<span id="cb10-5"><a href="tidyverse-primer.html#cb10-5"></a><span class="co">#&gt; </span></span>
<span id="cb10-6"><a href="tidyverse-primer.html#cb10-6"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb10-7"><a href="tidyverse-primer.html#cb10-7"></a><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span id="cb10-8"><a href="tidyverse-primer.html#cb10-8"></a><span class="co">#&gt; -3.013 -1.130 -0.391  0.965  3.780 </span></span>
<span id="cb10-9"><a href="tidyverse-primer.html#cb10-9"></a><span class="co">#&gt; </span></span>
<span id="cb10-10"><a href="tidyverse-primer.html#cb10-10"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb10-11"><a href="tidyverse-primer.html#cb10-11"></a><span class="co">#&gt;                  Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb10-12"><a href="tidyverse-primer.html#cb10-12"></a><span class="co">#&gt; (Intercept)       -7.2109     2.5509   -2.83   0.0086</span></span>
<span id="cb10-13"><a href="tidyverse-primer.html#cb10-13"></a><span class="co">#&gt; temp               3.6028     0.0973   37.03  &lt; 2e-16</span></span>
<span id="cb10-14"><a href="tidyverse-primer.html#cb10-14"></a><span class="co">#&gt; speciesO. niveus -10.0653     0.7353  -13.69  6.3e-14</span></span>
<span id="cb10-15"><a href="tidyverse-primer.html#cb10-15"></a><span class="co">#&gt;                     </span></span>
<span id="cb10-16"><a href="tidyverse-primer.html#cb10-16"></a><span class="co">#&gt; (Intercept)      ** </span></span>
<span id="cb10-17"><a href="tidyverse-primer.html#cb10-17"></a><span class="co">#&gt; temp             ***</span></span>
<span id="cb10-18"><a href="tidyverse-primer.html#cb10-18"></a><span class="co">#&gt; speciesO. niveus ***</span></span>
<span id="cb10-19"><a href="tidyverse-primer.html#cb10-19"></a><span class="co">#&gt; ---</span></span>
<span id="cb10-20"><a href="tidyverse-primer.html#cb10-20"></a><span class="co">#&gt; Signif. codes:  </span></span>
<span id="cb10-21"><a href="tidyverse-primer.html#cb10-21"></a><span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb10-22"><a href="tidyverse-primer.html#cb10-22"></a><span class="co">#&gt; </span></span>
<span id="cb10-23"><a href="tidyverse-primer.html#cb10-23"></a><span class="co">#&gt; Residual standard error: 1.79 on 28 degrees of freedom</span></span>
<span id="cb10-24"><a href="tidyverse-primer.html#cb10-24"></a><span class="co">#&gt; Multiple R-squared:  0.99,   Adjusted R-squared:  0.989 </span></span>
<span id="cb10-25"><a href="tidyverse-primer.html#cb10-25"></a><span class="co">#&gt; F-statistic: 1.33e+03 on 2 and 28 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>From these values, the chirp rate for each species increases by 3.6 chirps as the temperature increases by a single degree. This term shows strong statistical significance as evidenced by the p-value. The species term has a value of -10.07. This indicates that, across all temperature values, <em>O. niveus</em> is a chirp rate that is about 10 fewer chirps per minute. Similar to the temperature term, the species effect is associated with a very small p-value.</p>
<p>The only issue in this analysis is the intercept value. It indicates that at 0 C, there are -7.21 chirps per minute. While this is unreasonable, the data only go as low as 17.2 C and interpreting the model at 0 C would be an <em>extrapolation</em>. This would be a bad idea. That said, the model fit is good within the <em>applicable range</em> of the temperature values and the conclusions should be limited to the observed temperature range.</p>
<p>If there were a need to estimate the chirp rate at a temperature that was not observed in the experiment, the <code>predict()</code> method would be used. It takes the model object and a data frame of new values for prediction. For example, the model estimates the chirp rate for <em>O. exclamationis</em> for temperatures between 15 C and 20 C can be computed via:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="tidyverse-primer.html#cb11-1"></a>new_values &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">species =</span> <span class="st">&quot;O. exclamationis&quot;</span>, <span class="dt">temp =</span> <span class="dv">15</span><span class="op">:</span><span class="dv">20</span>)</span>
<span id="cb11-2"><a href="tidyverse-primer.html#cb11-2"></a><span class="kw">predict</span>(main_effect_fit, new_values)</span>
<span id="cb11-3"><a href="tidyverse-primer.html#cb11-3"></a><span class="co">#&gt;    1    2    3    4    5    6 </span></span>
<span id="cb11-4"><a href="tidyverse-primer.html#cb11-4"></a><span class="co">#&gt; 46.8 50.4 54.0 57.6 61.2 64.8</span></span></code></pre></div>
<p>Note that the non-numeric value of <code>species</code> is given to the predict method (as opposed to the binary indicator variable).</p>
<p>While this analysis has obviously not been an exhaustive demonstration of R’s modeling capabilities, it does highlight some of the major features:</p>
<ul>
<li><p>The language has an expressive syntax for specifying model terms for simple and fairly complex models.</p></li>
<li><p>For formula method has many conveniences for modeling that are also applied to new data when predictions are generated.</p></li>
<li><p>There are numerous helper functions (e.g., <code>anova()</code>, <code>summary()</code> and <code>predict()</code>) that are used to conduct specific calculations after the fitted model is created.</p></li>
</ul>
<p>Finally, as previously mentioned, this framework was devised in 1992. Most of the ideas and methods above were developed in that period and have remained remarkably relavant to this day. It highlights that the S language and, by extension R, has been designed as a language for data analysis since its inception.</p>
</div>
<div id="why-tidiness-is-important-for-modeling" class="section level2" number="2.4">
<h2 number="2.4"><span class="header-section-number">2.4</span> Why tidiness is important for modeling</h2>
</div>
<div id="some-additional-tidy-principals-for-modeling." class="section level2" number="2.5">
<h2 number="2.5"><span class="header-section-number">2.5</span> Some additional tidy principals for modeling.</h2>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Most model functions implicitly add an intercept column.<a href="tidyverse-primer.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="two-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/topepo/TMwR-temp/edit/master/tidyverse.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
